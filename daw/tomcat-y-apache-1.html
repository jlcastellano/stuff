<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual de Instalación de Apache Tomcat con SSL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }

        h1,
        h2,
        h3 {
            color: #2c5282;
            border-bottom: 2px solid #4299e1;
            padding-bottom: 5px;
        }

        .command {
            background-color: #1a202c;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        .note {
            background-color: #ebf8ff;
            border-left: 4px solid #4299e1;
            padding: 10px;
            margin: 10px 0;
        }

        .warning {
            background-color: #fff5f5;
            border-left: 4px solid #f56565;
            padding: 10px;
            margin: 10px 0;
        }

        .code-block {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <h1>Instalación y Configuración de Apache Tomcat con SSL</h1>

    <h2>1. Prerequisitos</h2>

    <h3>1.1. Instalación de Java</h3>
    <div class="command">
        <pre>
        sudo apt update
        sudo apt install default-jdk</pre>
    </div>
    <div class="command">
        <pre>
        java -version</pre>
    </div>

    <h3>1.2. Instalación de Herramientas SSL</h3>
    <div class="command">
        <pre>
        sudo apt install openssl</pre>
    </div>

    <h2>2. Configuración Inicial</h2>

    <h3>2.1. Crear Usuario y Grupo</h3>
    <div class="command">
        <pre>
        sudo groupadd tomcat
        sudo useradd -s /bin/false -g tomcat -d /opt/tomcat tomcat</pre>
    </div>

    <h3>2.2. Descargar e Instalar Tomcat</h3>
    <div class="command">
        <pre>
        cd /tmp
        wget https://dlcdn.apache.org/tomcat/tomcat-10/v10.1.35/bin/apache-tomcat-10.1.35.tar.gz
        sudo mkdir /opt/tomcat
        sudo tar xzvf apache-tomcat-10*tar.gz -C /opt/tomcat/
        sudo chown -R tomcat: /opt/tomcat
        sudo sh -c 'chmod +x /opt/tomcat/apache-tomcat-10.1.35/bin/*.sh'</pre>
    </div>

    <h2>3. Configuración SSL</h2>

    <h3>3.1. Generar Certificado Autofirmado</h3>
    <div class="note">
        <p>Para entorno de producción, se recomienda usar un certificado de una CA reconocida.</p>
    </div>
    <div class="command">
        <pre>
        sudo mkdir /opt/tomcat/apache-tomcat-10.1.35/conf/ssl
        cd /opt/tomcat/apache-tomcat-10.1.35/conf/ssl
        
        sudo openssl req -new -newkey rsa:2048 -nodes -keyout tomcat.key -out tomcat.csr -subj "/C=ES/ST=Estado/L=Ciudad/O=Organizacion/CN=localhost"
        sudo openssl x509 -req -days 365 -in tomcat.csr -signkey tomcat.key -out tomcat.crt
        sudo openssl pkcs12 -export -in tomcat.crt -inkey tomcat.key -out tomcat.p12 -name tomcat -CAfile tomcat.crt -caname root</pre>
        <p>Asegúrate que los archivos tienen los permisos correctos:</p>
        <div class="command">
            <pre>
            sudo chown tomcat:tomcat /opt/tomcat/apache-tomcat-10.1.35/conf/ssl/tomcat.p12
            sudo chmod 640 /opt/tomcat/apache-tomcat-10.1.35/conf/ssl/tomcat.p12</pre>
        </div>
    </div>

    <h3>3.2. Configurar Tomcat para SSL</h3>
    <p>Editar el archivo server.xml:</p>
    <div class="command">
        <pre>
        sudo nano /opt/tomcat/apache-tomcat-10.1.35/conf/server.xml</pre>
    </div>

    <p>Añadir o modificar el connector HTTPS:</p>
    <div class="code-block">
        <pre>
&lt;Connector
    port="8443"
    protocol="org.apache.coyote.http11.Http11NioProtocol"
    maxThreads="150"
    SSLEnabled="true"
    &gt;
    &lt;SSLHostConfig&gt;
        &lt;Certificate
            certificateKeystoreFile="conf/ssl/tomcat.p12"
            certificateKeystorePassword="la-contraseña-que-usaste"
            certificateKeystoreType="PKCS12"
            type="RSA"
        /&gt;
    &lt;/SSLHostConfig&gt;
&lt;/Connector&gt;
        </pre>
    </div>

    <h3>3.3. Configurar usuarios y roles</h3>
    <div class="command">
        <pre>
        sudo nano /opt/tomcat/apache-tomcat-10.1.35/conf/tomcat-users.xml</pre>
    </div>

    <div class="code-block">
        <pre>
&lt;role rolename="manager-gui"/&gt;
&lt;role rolename="admin-gui"/&gt;
&lt;user username="admin" password="tu-contraseña-segura" roles="manager-gui,admin-gui"/&gt;
        </pre>
    </div>

    <h3>3.4. Configurar el Servicio Systemd</h3>
    <div class="command">
        sudo nano /etc/systemd/system/tomcat.service
    </div>

    <div class="code-block">
        <pre>
[Unit]
Description=Apache Tomcat Web Application Container
After=network.target

[Service]
Type=forking
User=tomcat
Group=tomcat

Environment="JAVA_HOME=/usr/lib/jvm/default-java"
Environment="JAVA_OPTS=-Djava.security.egd=file:///dev/urandom"
Environment="CATALINA_BASE=/opt/tomcat/apache-tomcat-10.1.35"
Environment="CATALINA_HOME=/opt/tomcat/apache-tomcat-10.1.35"
Environment="CATALINA_PID=/opt/tomcat/apache-tomcat-10.1.35/temp/tomcat.pid"
Environment="CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC"

ExecStart=/opt/tomcat/apache-tomcat-10.1.35/bin/startup.sh
ExecStop=/opt/tomcat/apache-tomcat-10.1.35/bin/shutdown.sh

[Install]
WantedBy=multi-user.target
        </pre>
    </div>

    <h2>4. Iniciar y Habilitar Tomcat</h2>
    <div class="command">
        <pre>
        sudo systemctl daemon-reload
        sudo systemctl start tomcat
        sudo systemctl enable tomcat</pre>
    </div>

    <h2>5. Configurar Firewall</h2>
    <div class="command">
        <pre>
        sudo ufw allow 8443/tcp
        sudo ufw status</pre>
    </div>

    <div class="warning">
        <h3>Consideraciones de Seguridad:</h3>
        <ul>
            <li>Utilizar contraseñas fuertes para los certificados y usuarios</li>
            <li>En producción, usar certificados de una CA reconocida</li>
            <li>Mantener actualizado el sistema y Tomcat</li>
            <li>Configurar correctamente los permisos de archivos de certificados</li>
        </ul>
    </div>

    <div class="note">
        <h3>Acceso a Tomcat</h3>
        <p>Una vez configurado, podrás acceder a Tomcat de forma segura a través de:</p>
        <div class="command">https://tu-servidor:8443</div>
    </div>

</body>

</html>